<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Altaris â€” Deal Pipeline</title>
  <style>
    :root { --bg:#1b1b1b; --fg:#f0f0f0; --panel:#2a2a2a; --line:#333; --card:#1f1f1f; --accent:#4ea3ff; }
    *{box-sizing:border-box}
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; background: var(--bg); color: var(--fg); }
    header { padding: 14px 16px; border-bottom: 1px solid var(--line); display: flex; justify-content: space-between; align-items: center; background: #222; position: sticky; top:0; z-index: 5; }
    .actions { display:flex; gap:8px; align-items:center; }
    button { background: var(--accent); border: none; color: white; padding: 6px 12px; border-radius: 4px; cursor: pointer; }
    button:hover { filter: brightness(0.9); }
    .ghost-btn { background:#3b3b3b; border:1px solid #555; color:#fff; }
    .wrap { padding: 12px 16px; }
    .stats, .charts { display: flex; gap: 16px; flex-wrap: wrap; padding: 12px 0; }
    .stat { padding: 10px; border: 1px solid var(--line); border-radius: 8px; min-width: 140px; background: var(--panel); cursor:pointer; }
    .stat .label { font-size: 12px; opacity: .7; }
    .stat .value { font-size: 22px; font-weight: 700; }
    .stat.active { outline:2px solid var(--accent); box-shadow:0 0 0 2px #4ea3ff33 inset; }

    /* Board + cards */
    .board { display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; padding-bottom: 24px; margin-top: 12px; }
    .col { border: 1px solid var(--line); border-radius: 8px; padding: 8px; background: var(--panel); min-height: 200px; }
    .col b { text-transform: capitalize; font-size: 14px; }
    .card { margin-top: 8px; padding: 8px; border: 1px solid #444; border-radius: 6px; background: var(--card); position:relative; }
    .card-header { display:flex; align-items:center; justify-content:space-between; gap:8px; }

    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 6px; }
    .row label { font-size: 12px; display: flex; gap: 6px; align-items: center; }
    .row input, .row select { width: 100%; background: #333; color: white; border: 1px solid #555; border-radius: 4px; padding: 4px; }
    .buttons { display: flex; gap: 8px; margin-top: 6px; flex-wrap: wrap; }
    .topform { display:flex; gap:8px; flex-wrap:wrap; align-items:center; padding: 12px 16px; }
    .topform input, .topform select { background:#333; color:#fff; border:1px solid #555; border-radius:4px; padding:6px; }
    canvas { background: var(--panel); border-radius: 8px; padding: 8px; }

    .funds { margin-top:8px; padding-top:8px; border-top:1px dashed #444; }
    .fund-row { display:flex; gap:8px; align-items:center; font-size: 13px; flex-wrap: wrap; }

    /* Chips + chip buttons */
    .chip { background:#333; border:1px solid #555; border-radius:999px; padding:2px 8px; }
    .chip-btn { background:#333; border:1px solid #555; color:#fff; border-radius:999px; padding:6px 12px; cursor:pointer; }
    .chip-btn:hover { border-color:#6b7280; filter:none; }
    .light { opacity:.75; }

    .drop { border:2px dashed #555; border-radius:8px; padding:12px; text-align:center; margin-left: 12px; color:#bbb; }
    .drop.drag { border-color:#4ea3ff; color:#fff; }
    .err { color:#ff7b7b; font-size:12px; }
    .ok { color:#9acd32; font-size:12px; }

    /* Unified toolbar */
    #filtersToolbar { display:flex; flex-wrap:wrap; gap:10px; align-items:center; margin-bottom: 8px; }
    #searchBox { background:#333; color:#fff; border:1px solid #555; border-radius:4px; padding:6px; }

    /* Modal */
    .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:1000; align-items:center; justify-content:center; }
    .modal.open { display:flex; }
    .modal-card { background:#2a2a2a; color:#f0f0f0; padding:20px; border-radius:8px; width:min(640px, 92vw); max-height:80vh; overflow:auto; box-shadow:0 12px 40px rgba(0,0,0,0.6); }
    .modal-card h3 { margin:0 0 8px 0; }
    .modal-footer { display:flex; gap:8px; margin-top:12px; }
    .modal-footer button { background:#3b83f6; }
    .list-row { display:flex; align-items:center; justify-content:space-between; gap:8px; padding:8px 0; border-bottom:1px solid #3a3a3a; }
    .list-row .meta { font-size:12px; color:#bbb; }

    /* Clip (outlined) + badge */
    .clip-btn { width:34px; height:34px; border-radius:8px; padding:0; display:inline-flex; align-items:center; justify-content:center;
                background:#25272c; border:1px solid #5a5f69; position:relative; }
    .clip-btn:hover { border-color:var(--accent); box-shadow:0 0 0 2px #4ea3ff33 inset; }
    .clip-svg { width:18px; height:18px; stroke:#e5e7eb; fill:none; stroke-width:1.8; display:block; }
    .clip-badge { position:absolute; top:-6px; right:-6px; min-width:18px; height:18px; padding:0 5px;
                  background:var(--accent); color:#0b1220; border:2px solid #1f2937; border-radius:999px;
                  font-size:11px; font-weight:700; line-height:14px; display:none; align-items:center; justify-content:center; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./config.js"></script>
    <!-- Altaris Docs Chat config -->
<script>
  // Supabase prod example:
  window.DOCS_CHAT_CONFIG = {
    endpoint: "https://volftexuyqyykrnewewa.supabase.co/functions/v1/doc-search",
    topK: 5
  };

  // For local dev with the Supabase CLI, you can use:
  // window.DOCS_CHAT_CONFIG = { endpoint: "http://localhost:54321/functions/v1/doc-search", topK: 5 };
</script>
</head>
<body>
  <header>
    <div>
      <div style="font-size:20px; font-weight:700;">Altaris â€” Deal Pipeline</div>
      <div style="font-size:12px; opacity:.7;">outlined clip â€¢ chip clears â€¢ spacing</div>
    </div>
    <div class="actions">
      <input type="file" id="file" accept=".csv" style="display:none" />
      <button id="importBtn">â¬† Import CSV</button>
      <div id="drop" class="drop">or drag a CSV here</div>
      <button id="export">â¬‡ Export CSVs</button>
    </div>
  </header>

  <div class="topform">
    <input id="name" placeholder="Deal name" />
    <input id="source" placeholder="Source company" />
    <select id="type">
      <option>DirectLending</option>
      <option>Secondary</option>
      <option>CoInvest</option>
      <option>RealEstate</option>
    </select>
    <input id="currency" placeholder="Currency" value="USD" />
    <input id="size" type="number" step="0.01" placeholder="Size (M)" style="width:120px;" />
    <input id="sector" placeholder="Sector" />
    <button id="add">+ Add deal</button>
  </div>

  <div class="wrap">
    <div id="importStatus" class="light"></div>

    <section class="stats" id="stats"></section>

    <section class="charts">
      <canvas id="chartStage" width="380" height="240"></canvas>
      <canvas id="chartType" width="380" height="240"></canvas>
    </section>

    <!-- Filters row (chips + search + clears together) -->
    <div id="filtersToolbar">
      <div id="filterBar" class="fund-row" style="gap:8px;"></div>
      <input id="searchBox" placeholder="Search dealsâ€¦" />
      <button id="clearSearch" class="chip-btn">Clear search</button>
      <button id="clearAllFiltersBtn" class="chip-btn">Clear all</button>
    </div>

    <section class="board" id="board"></section>
  </div>

  <!-- ðŸ“Ž Attachment Modal -->
  <div id="attachmentModal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="attachTitle">
      <h3 id="attachTitle">Attachments</h3>
      <div id="attachmentList" class="light">Loadingâ€¦</div>
      <div class="modal-footer">
        <input type="file" id="attachFileInput" style="display:none;" multiple />
        <button id="attachUploadBtn">Upload</button>
        <button id="attachRefreshBtn" class="ghost-btn">Refresh</button>
        <button id="attachCloseBtn" class="ghost-btn" style="margin-left:auto;">Close</button>
      </div>
    </div>
  </div>


  <script src="/js/doc-ingest-client.js" defer></script>
  <script src="./js/chat-launcher.js" defer></script>
  <script src="./app.js"></script>

  


</body>
</html>
