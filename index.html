<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Altaris — Deal Pipeline (v5.7)</title>
  <style>
    :root { --bg:#1b1b1b; --fg:#f0f0f0; --panel:#2a2a2a; --line:#333; --card:#1f1f1f; --accent:#4ea3ff; }
    *{box-sizing:border-box}
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; background: var(--bg); color: var(--fg); }
    header { padding: 14px 16px; border-bottom: 1px solid var(--line); display: flex; justify-content: space-between; align-items: center; background: #222; position: sticky; top:0; z-index: 5; }
    .actions { display:flex; gap:8px; align-items:center; }
    button { background: var(--accent); border: none; color: white; padding: 6px 12px; border-radius: 4px; cursor: pointer; }
    button:hover { filter: brightness(0.9); }
    .wrap { padding: 12px 16px; }
    .stats, .charts { display: flex; gap: 16px; flex-wrap: wrap; padding: 12px 0; }
    .stat { padding: 10px; border: 1px solid var(--line); border-radius: 8px; min-width: 140px; background: var(--panel); }
    .stat .label { font-size: 12px; opacity: .7; }
    .stat .value { font-size: 22px; font-weight: 700; }
    .board { display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; padding-bottom: 24px; }
    .col { border: 1px solid var(--line); border-radius: 8px; padding: 8px; background: var(--panel); min-height: 200px; }
    .col b { text-transform: capitalize; font-size: 14px; }
    .card { margin-top: 8px; padding: 8px; border: 1px solid #444; border-radius: 6px; background: var(--card); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 6px; }
    .row label { font-size: 12px; display: flex; gap: 6px; align-items: center; }
    .row input, .row select { width: 100%; background: #333; color: white; border: 1px solid #555; border-radius: 4px; padding: 4px; }
    .buttons { display: flex; gap: 8px; margin-top: 6px; flex-wrap: wrap; }
    .topform { display:flex; gap:8px; flex-wrap:wrap; align-items:center; padding: 12px 16px; }
    .topform input, .topform select { background:#333; color:#fff; border:1px solid #555; border-radius:4px; padding:6px; }
    canvas { background: var(--panel); border-radius: 8px; padding: 8px; }
    .funds { margin-top:8px; padding-top:8px; border-top:1px dashed #444; }
    .fund-row { display:flex; gap:8px; align-items:center; font-size: 13px; flex-wrap: wrap; }
    .chip { background:#333; border:1px solid #555; border-radius:999px; padding:2px 8px; }
    .light { opacity:.75; }
    .drop { border:2px dashed #555; border-radius:8px; padding:12px; text-align:center; margin-left: 12px; color:#bbb; }
    .drop.drag { border-color:#4ea3ff; color:#fff; }
    .err { color:#ff7b7b; font-size:12px; }
    .ok { color:#9acd32; font-size:12px; }
    .filters { display:flex; gap:8px; align-items:center; margin: 6px 0 2px 0; flex-wrap: wrap; }
    .search { display:flex; gap:6px; align-items:center; }
    .search input { background:#333; color:#fff; border:1px solid #555; border-radius:4px; padding:6px 8px; min-width:220px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./config.js"></script>
</head>
<body>
  <header>
    <div>
      <div style="font-size:20px; font-weight:700;">Altaris — Deal Pipeline</div>
      <div style="font-size:12px; opacity:.7;">v5.7 (Search bar, chart label + legend fixes)</div>
    </div>
    <div class="actions">
      <input type="file" id="file" accept=".csv" style="display:none" />
      <button id="importBtn">⬆ Import CSV</button>
      <div id="drop" class="drop">or drag a CSV here</div>
      <button id="export">⬇ Export CSVs</button>
    </div>
  </header>

  <div class="topform">
    <input id="name" placeholder="Deal name" />
    <input id="source" placeholder="Source company" />
    <select id="type">
      <option>DirectLending</option>
      <option>Secondary</option>
      <option>CoInvest</option>
      <option>RealEstate</option>
    </select>
    <input id="currency" placeholder="Currency" value="USD" />
    <input id="size" type="number" step="0.01" placeholder="Size (M)" style="width:120px;" />
    <input id="sector" placeholder="Sector" />
    <button id="add">+ Add deal</button>
  </div>

  <div class="wrap">
    <div id="importStatus" class="light"></div>
    <section class="stats" id="stats"></section>
    <section class="charts">
      <canvas id="chartStage" width="380" height="240"></canvas>
      <canvas id="chartType" width="380" height="240"></canvas>
    </section>

    <div class="filters">
      <div id="filterBar" class="fund-row"></div>
      <div class="search">
        <input id="searchBox" placeholder="Search deals…" />
        <button id="clearSearch">Clear search</button>
      </div>
    </div>

    <section class="board" id="board"></section>
  </div>

  <script src="./app.js"></script>
</body>
</html>
